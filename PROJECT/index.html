<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quickfolio - Instant Professional Portfolios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Custom CSS for Glow Effect and Slider */
        .nav-link-glow {
            padding: 0.35rem 1rem;
            border-radius: 9999px; /* full rounded pill */
            transition: all 0.2s ease-in-out;
        }
        /* Glowing frame effect on hover */
        .nav-link-glow:hover {
            background-color: #1f2937; /* gray-800 */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); /* blue glow */
            color: white !important;
        }
        /* Ensure the active link also glows */
        .nav-link-glow.active {
            background-color: #1e3a8a; /* blue-800 */
            color: white !important;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
        }
        
        /* Light Mode Styling */
        body.light-mode {
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-900 */
        }
        body.light-mode header {
            background-color: #ffffffd9; /* white with transparency */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        body.light-mode h1, body.light-mode h2, body.light-mode h3, body.light-mode h4 {
            color: #1f2937;
        }
        body.light-mode .template-card {
            background-color: #ffffff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Slider CSS */
        .slider-container {
            position: relative;
            height: 350px; /* Fixed height for better visual */
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .slider-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .slider-image.active {
            opacity: 1;
        }

        /* Professional Template Specific Styling */
        .pro-bg {
            /* Using a linear gradient as a mock background for the professional template */
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-radius: 1.5rem;
            padding: 3rem 0;
        }
        .pro-main-content {
            background-color: #111827;
            border: 1px solid #374151;
        }
        .pro-text-accent {
            color: #a78bfa; /* purple-400 */
            text-shadow: 0 0 10px rgba(167, 139, 250, 0.4);
        }
    </style>

    <script>
        // --- MOCK FIREBASE GLOBALS ---
        // Since we removed the actual database connection for the demo,
        // we define mock globals to prevent errors.
        let db = null; 
        let auth = null;
        let appId = 'mock-app-id';
        let userId = 'mock-user-id'; 
        let folioId = null; // Stores the unique ID of the saved document

        // State management
        const appState = {
            currentPage: 'welcome',
            profileType: '',
            formData: {
                extraLinks: [] // Initialize array for dynamic links
            }
        };

        // --- Core Application Logic ---

        const pages = {
            welcome: renderWelcomePage,
            templates: renderTemplatesPage,
            form: renderFormPage,
            preview: renderPreviewPage,
            linkReady: renderLinkReadyPage,
            contact: renderContactPage
        };

        // Define form fields for each profile type
        const professions = {
            'Professionals': [
                { id: 'fullName', label: 'Full Name', type: 'text', placeholder: 'John Doe' },
                { id: 'jobTitle', label: 'Job Title', type: 'text', placeholder: 'Lead Software Engineer' },
                { id: 'company', label: 'Current Company/Organization', type: 'text', placeholder: 'Google' },
                { id: 'bio', label: 'Short Professional Bio', type: 'textarea', placeholder: 'A brief introduction about your career and focus...' },
                { id: 'linkedin', label: 'LinkedIn Profile URL', type: 'text', placeholder: 'https://linkedin.com/in/yourname' },
                { id: 'skills', label: 'Key Skills (comma separated)', type: 'textarea', placeholder: 'JavaScript, React, Tailwind CSS, Cloud Architecture' },
                { id: 'projects', label: 'Notable Projects/Achievements', type: 'textarea', placeholder: 'Project A: A brief description\\nProject B: Another description' },
                { id: 'contactEmail', label: 'Contact Email', type: 'email', placeholder: 'your.email@example.com' },
            ],
            'Students': [
                { id: 'fullName', label: 'Full Name', type: 'text', placeholder: 'Jane Doe' },
                { id: 'university', label: 'University/College', type: 'text', placeholder: 'University of Science' },
                { id: 'major', label: 'Major/Field of Study', type: 'text', placeholder: 'Computer Science' },
                { id: 'graduationYear', label: 'Expected Graduation Year', type: 'number', placeholder: '2026' },
                { id: 'bio', label: 'Short Academic Bio', type: 'textarea', placeholder: 'A student passionate about research and technology...' },
                { id: 'linkedin', label: 'LinkedIn Profile URL', type: 'text', placeholder: 'https://linkedin.com/in/yourname' },
                { id: 'github', label: 'GitHub Profile URL', type: 'text', placeholder: 'https://github.com/yourusername' },
                { id: 'projects', label: 'Academic Projects/Internships', type: 'textarea', placeholder: 'Project A: Built a full-stack app\\nProject B: AI research paper' },
                { id: 'contactEmail', label: 'Contact Email', type: 'email', placeholder: 'your.email@example.com' },
            ],
            'Business Owners': [
                { id: 'businessName', label: 'Business Name', type: 'text', placeholder: 'Quickfolio Inc.' },
                { id: 'ownerName', label: 'Owner/Founder Name', type: 'text', placeholder: 'Alex Smith' },
                { id: 'businessType', label: 'Type of Business', type: 'text', placeholder: 'E-commerce, Tech Startup, Creative Agency' },
                { id: 'description', label: 'Business Description/Mission', type: 'textarea', placeholder: 'A brief description of your company and its goals...' },
                { id: 'website', label: 'Business Website URL', type: 'text', placeholder: 'https://yourbusiness.com' },
                { id: 'facebook', label: 'Facebook/Social Link', type: 'text', placeholder: 'https://facebook.com/yourbusiness' },
                { id: 'products', label: 'Key Products/Services', type: 'textarea', placeholder: 'Service A: Brief description\\nProduct B: Brief description' },
                { id: 'location', label: 'Location/Service Area', type: 'text', placeholder: 'City, Country' },
                { id: 'contactEmail', label: 'Contact Email', type: 'email', placeholder: 'business.email@example.com' },
                // Only Max 3 images allowed for the slider
                { id: 'imageLink1', label: 'Image Link 1 (e.g., Shop/Food Photo)', type: 'text', placeholder: 'https://placehold.co/600x400' },
                { id: 'imageLink2', label: 'Image Link 2', type: 'text', placeholder: 'https://placehold.co/600x400' },
                { id: 'imageLink3', label: 'Image Link 3', type: 'text', placeholder: 'https://placehold.co/600x400' },
            ]
        };

        // Variables for DOM elements (initialized in window.onload)
        let mainContent;
        let backButton;


        // --- Utility Functions ---

        function updateUI() {
            mainContent.innerHTML = '';
            pages[appState.currentPage]();

            // Manage back button visibility
            if (appState.currentPage === 'welcome' || appState.currentPage === 'contact') {
                backButton.style.display = 'none';
            } else {
                backButton.style.display = 'block';
            }

            // Update active nav link
            document.querySelectorAll('.nav-link-glow').forEach(link => {
                link.classList.remove('active');
            });
            const activeLink = document.querySelector(`.nav-link-glow[onclick*="showPage('${appState.currentPage}')"]`);
            if (activeLink && (appState.currentPage === 'welcome' || appState.currentPage === 'templates' || appState.currentPage === 'contact')) {
                activeLink.classList.add('active');
            }
        }
        
        function showPage(pageId) {
            appState.currentPage = pageId;
            updateUI();
            // Hide menu on page change
            document.getElementById('menu-overlay').classList.add('hidden');
        }

        function goBack() {
            if (appState.currentPage === 'templates') {
                appState.currentPage = 'welcome';
            } else if (appState.currentPage === 'form') {
                appState.currentPage = 'templates';
            } else if (appState.currentPage === 'preview') {
                appState.currentPage = 'form';
            } else if (appState.currentPage === 'linkReady') {
                appState.currentPage = 'preview';
            }
            updateUI();
        }

        function selectProfession(profession) {
            appState.profileType = profession;
            appState.currentPage = 'form';
            updateUI();
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const formData = { ...appState.formData }; // Preserve photo data

            // 1. Capture fixed fields
            professions[appState.profileType].forEach(field => {
                const element = form.elements[field.id];
                if (element) {
                    formData[field.id] = element.value;
                }
            });

            // 2. Capture dynamic extra links (only for Professionals/Students)
            if (appState.profileType !== 'Business Owners') {
                const linkInputs = form.querySelectorAll('.extra-link-input');
                const titleInputs = form.querySelectorAll('.extra-title-input');
                
                const extraLinks = [];
                linkInputs.forEach((linkEl, index) => {
                    if (linkEl.value && titleInputs[index].value) {
                        extraLinks.push({ 
                            url: linkEl.value, 
                            title: titleInputs[index].value 
                        });
                    }
                });
                formData.extraLinks = extraLinks;
            } else {
                 formData.extraLinks = []; // Ensure it's empty for business owners
            }


            appState.formData = formData;
            appState.currentPage = 'preview';
            updateUI();
        }
        
        /**
         * MOCK FUNCTION: Generates a temporary link (replaces Firebase savePortfolio)
         */
        function generateMockLink() {
            const saveButton = document.getElementById('save-folio-btn');
            const originalText = saveButton.innerHTML;
            saveButton.disabled = true;
            
            saveButton.innerHTML = 'Generating... <svg class="animate-spin h-5 w-5 ml-2 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            
            // Simulate saving time
            setTimeout(() => {
                // Generate a unique, temporary ID
                folioId = crypto.randomUUID(); 
                
                saveButton.innerHTML = 'Generated!';
                showPage('linkReady');
            }, 1500);
        }


        function copyText(elementId) {
            const copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand("copy");
            // Simple visual confirmation
            const originalValue = copyText.value;
            copyText.value = 'Link Copied!';
            setTimeout(() => {
                copyText.value = originalValue;
            }, 1000);
        }
        
        // --- New Menu and Theme Logic ---

        function toggleSettingsMenu() {
            const nestedMenu = document.getElementById('settings-nested-menu');
            const arrow = document.getElementById('settings-arrow');
            
            nestedMenu.classList.toggle('hidden');
            
            // Rotate arrow icon
            if (!nestedMenu.classList.contains('hidden')) {
                arrow.classList.add('rotate-90');
            } else {
                arrow.classList.remove('rotate-90');
            }
        }

        function toggleMenu() {
            const menu = document.getElementById('menu-overlay');
            const nestedMenu = document.getElementById('settings-nested-menu');
            const arrow = document.getElementById('settings-arrow');
            
            menu.classList.toggle('hidden');

            // If the main menu is closed, also close the nested menu and reset the arrow
            if (menu.classList.contains('hidden')) {
                nestedMenu.classList.add('hidden');
                arrow.classList.remove('rotate-90');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            const nestedMenu = document.getElementById('settings-nested-menu');
            
            // Check if currently in dark mode (default)
            const isDarkMode = !body.classList.contains('light-mode');

            if (isDarkMode) {
                // Switch to Light Mode
                body.classList.add('light-mode');
                themeIcon.innerHTML = '‚òÄÔ∏è';
                themeText.textContent = 'Light Mode';
                nestedMenu.classList.remove('bg-gray-800'); // Clean up nested menu dark specific styles
            } else {
                // Switch back to Dark Mode
                body.classList.remove('light-mode');
                themeIcon.innerHTML = 'üåô';
                themeText.textContent = 'Dark Mode';
                nestedMenu.classList.add('bg-gray-800'); // Re-add nested menu dark specific styles
            }
            // Close menu after selection
            toggleMenu();
        }


        // --- Search Functionality (Mock) ---
        function performSearch() {
            const query = document.getElementById('mock-search-input').value.trim().toLowerCase();
            const messageContainer = document.getElementById('search-message-container');
            
            // Clear previous message
            messageContainer.innerHTML = '';

            // Mock search results
            if (query === 'john doe' || query === 'alex smith' || query === 'quickfolio inc.') {
                messageContainer.innerHTML = `
                    <div class="p-3 mt-4 bg-green-900 text-green-300 rounded-xl font-semibold border-l-4 border-green-500 shadow-md">
                        ‚úÖ Found results for "${query}"! This is ready for backend integration.
                    </div>
                `;
            } else if (query) {
                messageContainer.innerHTML = `
                    <div class="p-3 mt-4 bg-yellow-900 text-yellow-300 rounded-xl font-semibold border-l-4 border-yellow-500 shadow-md">
                        ‚ö†Ô∏è No exact Quickfolio found for "${query}". Try searching 'John Doe' or 'Alex Smith'.
                    </div>
                `;
            } else {
                // If input is empty, clear the message
                messageContainer.innerHTML = '';
            }
        }
        
        // New function to handle the search icon click on the nav bar
        function searchNavClick() {
            // If not on the welcome page, navigate there first
            if (appState.currentPage !== 'welcome') {
                showPage('welcome');
            }
            // Attempt to focus the search input, allowing the page to render first if navigating
            setTimeout(() => {
                const searchInput = document.getElementById('mock-search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }, 100); 
        }

        function openContactModal() {
            const modalOverlay = document.getElementById('contact-modal-overlay');
            modalOverlay.style.display = 'flex';
        }
        
        function closeContactModal() {
            const modalOverlay = document.getElementById('contact-modal-overlay');
            modalOverlay.style.display = 'none';
        }


        // --- DYNAMIC FORM HANDLER ---
        function addExtraLinkField() {
            const container = document.getElementById('extra-links-container');
            const linkCount = container.children.length;

            const newFields = document.createElement('div');
            newFields.className = 'flex space-x-3 mb-3 dynamic-link-set';
            newFields.innerHTML = `
                <input type="text" placeholder="Link URL (e.g., https://mysite.com)" value="" class="extra-link-input w-1/2 px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-gray-900">
                <input type="text" placeholder="Link Title (e.g., My Portfolio)" value="" class="extra-title-input w-1/3 px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-gray-900">
                <button type="button" class="remove-link-btn w-1/6 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            `;
            container.insertBefore(newFields, container.lastElementChild); // Insert before the 'Add' button

            // Re-attach listener for the new remove button
            newFields.querySelector('.remove-link-btn').addEventListener('click', (e) => {
                e.currentTarget.closest('.dynamic-link-set').remove();
            });
        }
        
        function initializeExtraLinks() {
            const container = document.getElementById('extra-links-container');
            if (!container) return; // Exit if not on the form page or template doesn't use it

            // Clear placeholder and initial fields
            container.innerHTML = ''; 

            // Restore saved links
            (appState.formData.extraLinks || []).forEach(link => {
                const newFields = document.createElement('div');
                newFields.className = 'flex space-x-3 mb-3 dynamic-link-set';
                newFields.innerHTML = `
                    <input type="text" placeholder="Link URL (e.g., https://mysite.com)" value="${link.url}" class="extra-link-input w-1/2 px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-gray-900">
                    <input type="text" placeholder="Link Title (e.g., My Portfolio)" value="${link.title}" class="extra-title-input w-1/3 px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-gray-900">
                    <button type="button" class="remove-link-btn w-1/6 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                `;
                container.appendChild(newFields);
                
                // Attach remove listener
                newFields.querySelector('.remove-link-btn').addEventListener('click', (e) => {
                    e.currentTarget.closest('.dynamic-link-set').remove();
                });
            });

            // Add the 'Add' button back
            const addButton = document.createElement('button');
            addButton.type = 'button';
            addButton.className = 'text-sm text-blue-600 hover:text-blue-500 font-semibold flex items-center mt-3';
            addButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                Add Another Link/Certificate
            `;
            addButton.addEventListener('click', addExtraLinkField);
            container.appendChild(addButton);

            // Add one empty set if no links exist
            if ((appState.formData.extraLinks || []).length === 0) {
                 addExtraLinkField();
            }
        }


        // --- Page Rendering Functions ---

        function renderWelcomePage() {
            mainContent.innerHTML = `
                <div class="container mx-auto px-6 text-center pt-24 pb-20 main-content">
                    <h2 class="text-5xl font-extrabold text-white leading-tight mb-4">
                        <span class="text-blue-400 inline-block animate-pulse">Quickfolio</span>
                    </h2>
                    <p class="text-xl text-gray-300 mb-10 max-w-3xl mx-auto">
                        Your Professional Portfolio in Minutes.
                    </p>
                    
                    <!-- New Search Bar -->
                    <div class="mt-10 max-w-xl mx-auto">
                        <div class="flex space-x-2">
                            <input type="text" id="mock-search-input" placeholder="Search for a Quickfolio (e.g., 'John Doe')" class="w-full px-5 py-3 rounded-full border-2 border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-shadow shadow-md text-lg bg-gray-900 text-white">
                            <button class="bg-blue-600 text-white p-3 rounded-full hover:bg-blue-700 transition-colors shadow-md flex-shrink-0" onclick="performSearch()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </button>
                        </div>
                        <div id="search-message-container"></div>
                        <p class="text-sm text-gray-400 mt-3 font-semibold">Search for profiles that have been generated on Quickfolio.</p>
                    </div>
                    <!-- End Search Bar -->

                    <button class="mt-12 bg-blue-600 text-white font-bold py-4 px-10 text-xl rounded-full shadow-xl shadow-blue-400/50 hover:bg-blue-700 transition-transform transform hover:scale-105" onclick="showPage('templates')">
                        Start Building Now!
                    </button>
                    
                </div>
            `;
        }

        function renderTemplatesPage() {
            mainContent.innerHTML = `
                <div class="container mx-auto px-6 main-content">
                    <h2 class="text-4xl font-bold text-white text-center mb-16">
                        1. Choose Your Path
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                        
                        <!-- Professionals Card -->
                        <div class="template-card p-6 rounded-xl flex flex-col items-center text-center cursor-pointer border-t-4 border-blue-500 hover:border-blue-400" onclick="selectProfession('Professionals')">
                            <!-- Attractive Image Placeholder (Replaced with specific PNG) -->
                            <div class="w-full h-32 bg-gray-800 rounded-lg mb-4 flex items-center justify-center border border-blue-900">
                                <img src="https://cdn-icons-png.flaticon.com/512/1869/1869679.png" alt="Professional Icon" class="h-24 w-24 object-contain">
                            </div>
                            <!-- Logo/Icon (Secondary Icon kept as SVG for consistency) -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-400 mb-2" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M8.25 6.75a3.75 3.75 0 1 1 7.5 0a3.75 3.75 0 0 1-7.5 0ZM15.75 9.75a3 3 0 1 1 6 0a3 3 0 0 1-6 0ZM4.505 19.539L4.5 19.5c.345.545.698 1.05.997 1.488a.75.75 0 0 0 .573.284l.799-.071a1.996 1.996 0 0 1 1.056-.474L10 18.75m-6.495-1.127A7.258 7.258 0 0 1 20.724 17.5c.571 0 1.077.416 1.155.992l.707 5.291c.07.525-.262 1.01-1.026.839L15.3 22.186c-1.353.307-2.823.514-4.298.599V19.5M4.505 19.539A1.5 1.5 0 0 1 3 19.5c0-.825.195-1.6.538-2.311M14.25 15.75a3 3 0 1 0-6 0a3 3 0 0 0 6 0ZM12 18a1.5 1.5 0 0 0 1.5-1.5c0-.795-.316-1.55-.879-2.091L11.25 12h-1.5l.629 1.123c-.562.54-.879 1.305-.879 2.091a1.5 1.5 0 0 0 1.5 1.5Z" clip-rule="evenodd" /></svg>
                            <h3 class="text-2xl font-bold text-white mb-1">Professionals</h3>
                            <!-- Short Description -->
                            <p class="text-gray-400 text-sm">For experts and freelancers. Showcase achievements and work history.</p>
                        </div>

                        <!-- Business Owners Card -->
                        <div class="template-card p-6 rounded-xl flex flex-col items-center text-center cursor-pointer border-t-4 border-emerald-500 hover:border-emerald-400" onclick="selectProfession('Business Owners')">
                            <!-- Attractive Image Placeholder (Replaced with specific PNG) -->
                            <div class="w-full h-32 bg-gray-800 rounded-lg mb-4 flex items-center justify-center border border-emerald-900">
                                <img src="https://cdn-icons-png.flaticon.com/512/6231/6231773.png" alt="Business Owner Icon" class="h-24 w-24 object-contain">
                            </div>
                            <!-- Logo/Icon (Secondary Icon kept as SVG for consistency) -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-emerald-400 mb-2" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M1.5 3A1.5 1.5 0 0 0 0 4.5v15A1.5 1.5 0 0 0 1.5 21h21a1.5 1.5 0 0 0 1.5-1.5v-15A1.5 1.5 0 0 0 22.5 3H1.5ZM7.5 7.5a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 0 1.5h-.75a.75.75 0 0 1-.75-.75Zm-.75 2.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5ZM7.5 12.75a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 0 1.5h-.75a.75.75 0 0 1-.75-.75Zm-.75 2.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5ZM16.5 7.5a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 0 1.5h-.75a.75.75 0 0 1-.75-.75Zm-.75 2.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5ZM16.5 12.75a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 1 0 1.5h-.75a.75.75 0 0 1-.75-.75Zm-.75 2.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5Z" clip-rule="evenodd" /></svg>
                            <h3 class="text-2xl font-bold text-white mb-1">Business Owners</h3>
                            <!-- Short Description -->
                            <p class="text-gray-400 text-sm">For agencies and sole proprietors. Highlight services and testimonials.</p>
                        </div>

                        <!-- College Students Card -->
                        <div class="template-card p-6 rounded-xl flex flex-col items-center text-center cursor-pointer border-t-4 border-fuchsia-500 hover:border-fuchsia-400" onclick="selectProfession('Students')">
                            <!-- Attractive Image Placeholder (Updated to WEBP link) -->
                            <div class="w-full h-32 bg-gray-800 rounded-lg mb-4 flex items-center justify-center border border-fuchsia-900">
                                <img src="https://logowik.com/content/uploads/images/t_university-student6136.logowik.com.webp" alt="Student Icon" class="h-24 w-24 object-contain">
                            </div>
                            <!-- Logo/Icon (Secondary Icon kept as SVG for consistency) -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-fuchsia-400 mb-2" viewBox="0 0 24 24" fill="currentColor"><path d="M11.666 4.394a1.8 1.8 0 0 1 1.597 0l6.985 3.328A1.8 1.8 0 0 1 21 9.382v5.236a1.8 1.8 0 0 1-.752 1.48L12.75 19.606a1.8 1.8 0 0 1-1.597 0l-6.985-3.328A1.8 1.8 0 0 1 3 14.618V9.382a1.8 1.8 0 0 1 .752-1.48zM12 5.923L5.341 9.076a.3.3 0 0 0-.001.077v5.337a.3.3 0 0 0 .142.253L12 18.077l6.518-3.334a.3.3 0 0 0 .142-.253V9.153a.3.3 0 0 0-.001-.077L12 5.923Z" /><path d="M12 12a.75.75 0 0 1 .75-.75h.75a.75.75 0 0 0 0-1.5h-.75V9a.75.75 0 0 0-1.5 0v.75H9a.75.75 0 0 0 0 1.5h.75V12a.75.75 0 0 0 1.5 0V12Z" /></svg>
                            <h3 class="text-2xl font-bold text-white mb-1">College Students</h3>
                            <!-- Short Description -->
                            <p class="text-gray-400 text-sm">For students to present academic projects and extracurriculars.</p>
                        </div>

                    </div>
                </div>
            `;
        }
        
        function renderFormPage() {
            const fields = professions[appState.profileType];
            let formHTML = `
                <div class="container mx-auto px-6 main-content">
                    <h2 class="text-4xl font-bold text-white text-center mb-12">
                        2. Enter Your Details <span class="text-xl text-blue-400 font-medium">(${appState.profileType})</span>
                    </h2>
                    <!-- FORM CONTAINER: OVERRIDES DARK MODE STYLING WITH LIGHT, PROFESSIONAL COLORS -->
                    <form id="details-form" class="max-w-4xl mx-auto rounded-3xl shadow-2xl shadow-gray-900/50 space-y-0 overflow-hidden">
                        
                        <!-- TOP SECTION: Profile Photo Upload Area (Color 1: Light Gray) -->
                        <div class="bg-gray-100 p-8 pt-10 border-b border-gray-300">
                            <div class="flex flex-col items-center space-y-4">
                                <label for="profilePhoto" class="block text-xl font-semibold text-gray-800">Profile Photo/Business Logo</label>
                                <div class="relative w-40 h-40 rounded-full overflow-hidden border-4 border-dashed border-gray-400 flex items-center justify-center cursor-pointer hover:border-blue-500 transition-colors">
                                    <img id="profile-photo-preview" class="w-full h-full object-cover ${appState.formData.profilePhoto ? '' : 'hidden'}" src="${appState.formData.profilePhoto || 'https://placehold.co/160x160/ffffff/000000?text=LOGO'}">
                                    <span id="photo-placeholder" class="text-6xl text-gray-500 ${appState.formData.profilePhoto ? 'hidden' : ''}">+</span>
                                    <input type="file" id="profilePhoto" name="profilePhoto" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*">
                                </div>
                            </div>
                        </div>
                        
                        <!-- BOTTOM SECTION: Input Fields Area (Color 2: White) -->
                        <div class="bg-white p-8 space-y-8 rounded-b-3xl">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                ${fields.filter(f => !f.id.startsWith('imageLink')).map(field => `
                                    <div class="space-y-2 ${field.type === 'textarea' ? 'md:col-span-2' : ''}">
                                        <label for="${field.id}" class="block text-sm font-bold text-gray-700">${field.label}</label>
                                        ${field.type === 'textarea' ?
                                            // Overriding global dark input styles for light form
                                            `<div class="flex flex-col space-y-2">
                                                <textarea id="${field.id}" name="${field.id}" placeholder="${field.placeholder}" rows="4" class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors text-base bg-white text-gray-900">${appState.formData[field.id] || ''}</textarea>
                                            </div>` :
                                            // Overriding global dark input styles for light form
                                            `<input type="${field.type}" id="${field.id}" name="${field.id}" value="${appState.formData[field.id] || ''}" placeholder="${field.placeholder}" class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors text-base bg-white text-gray-900">`
                                        }
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- Dynamic Links/Certificates Section (For Professionals/Students only) -->
                            ${appState.profileType !== 'Business Owners' ? `
                                <div class="pt-4 border-t border-gray-300">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">External Links / Certificates</h3>
                                    <div id="extra-links-container" class="space-y-3">
                                        <!-- Dynamic links will be initialized here by JS -->
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Business Images Section (Only for Business Owners) -->
                            ${appState.profileType === 'Business Owners' ? `
                                <div class="pt-4 border-t border-gray-300">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Business Gallery Images (Max 3 Links)</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        ${fields.filter(f => f.id.startsWith('imageLink')).map(field => `
                                            <div class="space-y-2">
                                                <label for="${field.id}" class="block text-sm font-bold text-gray-700">${field.label}</label>
                                                <input type="text" id="${field.id}" name="${field.id}" value="${appState.formData[field.id] || ''}" placeholder="${field.placeholder}" class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition-colors text-base bg-white text-gray-900">
                                            </div>
                                        `).join('')}
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">Use direct image URLs for best results (e.g., from a free photo hosting service).</p>
                                </div>
                            ` : ''}

                            <div class="flex justify-center pt-10">
                                <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-8 text-lg rounded-full shadow-xl shadow-blue-800/50 hover:bg-blue-700 transition-transform transform hover:scale-105">
                                    3. Preview Your Quickfolio
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            `;
            mainContent.innerHTML = formHTML;

            // Re-attach event listeners after DOM update
            document.getElementById('details-form').addEventListener('submit', handleFormSubmit);

            document.getElementById('profilePhoto').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const preview = document.getElementById('profile-photo-preview');
                        const placeholder = document.getElementById('photo-placeholder');
                        preview.src = e.target.result;
                        preview.classList.remove('hidden');
                        placeholder.classList.add('hidden');
                        appState.formData.profilePhoto = e.target.result; // Store as base64 for preview
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Initialize dynamic links for non-business templates
            if (appState.profileType !== 'Business Owners') {
                initializeExtraLinks();
            }
        }

        let imageSliderInterval;

        function renderPreviewPage() {
            const data = appState.formData;
            const name = data.fullName || data.ownerName || data.businessName || 'Quickfolio User';
            const title = data.jobTitle || data.businessType || data.major || 'Professional Profile';
            const bio = data.bio || data.description || 'No summary provided.';
            
            // Determine the main content to display as "Services"
            const serviceContent = data.products || data.projects || data.skills || '';
            const isProfessionalTemplate = appState.profileType === 'Professionals' || appState.profileType === 'Students';

            // --- VARIABLES DEFINED FOR BOTH PATHS ---
            
            // Filter out fields already used in the main display or service cards
            const detailFields = Object.entries(data)
                .filter(([key, value]) => 
                    value && 
                    !key.startsWith('imageLink') && 
                    key !== 'profilePhoto' && 
                    key !== 'fullName' && key !== 'ownerName' && key !== 'businessName' && 
                    key !== 'jobTitle' && key !== 'university' && key !== 'businessType' && key !== 'major' &&
                    key !== 'bio' && key !== 'description' &&
                    key !== 'products' && key !== 'projects' && key !== 'skills' &&
                    key !== 'extraLinks' // Exclude extraLinks object itself
                );

            const detailSectionsHTML = detailFields.length > 0 ? `
                <h3 class="text-3xl font-bold text-white mt-16 mb-6 border-t border-gray-600 pt-8">Contact & Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${detailFields.map(([key, value]) => `
                        <div class="p-3 rounded-lg border border-gray-600">
                            <h4 class="text-sm font-medium text-gray-400">${key.replace(/([A-Z])/g, ' $1').replace(/^.| ./g, str => str.toUpperCase())}</h4>
                            <p class="text-white font-semibold">${value}</p>
                        </div>
                    `).join('')}
                </div>
            ` : '';
            // --- END VARIABLE DEFINITION ---


            if (isProfessionalTemplate) {
                 // --- PROFESSIONAL TEMPLATE (Joe Greyson Style) ---

                // Split skills/projects for the card section
                const items = serviceContent.split(/[\n,]+/).map(item => item.trim()).filter(item => item !== '').slice(0, 6); // Max 6 tags/skills
                
                const socialLinksHTML = `
                    <div class="flex space-x-4">
                        ${data.linkedin ? `<a href="${data.linkedin}" target="_blank" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-900 hover:bg-gray-200 transition-colors shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.7c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM22 19h-3v-5.604c0-3.368-4-3.565-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                        </a>` : ''}
                        ${data.github ? `<a href="${data.github}" target="_blank" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-900 hover:bg-gray-200 transition-colors shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.385 3.431 9.387 8.257 10.871.71.131.986-.319.986-.681 0-.334-.012-1.201-.012-2.384-3.351.722-4.053-1.611-4.053-1.611-.548-1.387-1.334-1.756-1.334-1.756-1.087-.743.085-.729.085-.729 1.205.084 1.838 1.233 1.838 1.233 1.07 1.834 2.793 1.304 3.473.997.108-.775.421-1.305.767-1.604-2.665-.304-5.466-1.333-5.466-5.933 0-1.31.467-2.387 1.233-3.226-.123-.304-.535-1.524.117-3.176 0 0 1.006-.323 3.301 1.231.956-.265 1.961-.397 2.964-.401 1.003.004 2.009.136 2.964.401 2.295-1.554 3.301-1.231 3.301-1.231.653 1.652.241 2.872.118 3.176.766.839 1.232 1.916 1.232 3.226 0 4.61-2.802 5.624-5.474 5.923.433.372.823 1.102.823 2.222 0 1.604-.012 2.898-.012 3.297 0 .365.263.819.992.679c4.825-1.486 8.253-5.505 8.253-10.881C24 5.373 18.627 0 12 0z"/></svg>
                        </a>` : ''}
                    </div>
                `;

                const extraLinksList = (data.extraLinks || []).map(link => `
                    <div class="mb-2">
                        <a href="${link.url}" target="_blank" class="text-blue-400 hover:text-blue-300 font-semibold flex items-center transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.245-1.245" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.828 7.828L16.583 9.073l1.245-1.245a4 4 0 00-5.656-5.656l-4 4a4 4 0 105.656 5.656l1.245-1.245z" /></svg>
                            ${link.title}
                        </a>
                    </div>
                `).join('');

                return mainContent.innerHTML = `
                    <div class="pro-bg container mx-auto px-6 main-content min-h-[80vh] flex items-center">
                        <div class="pro-main-content w-full p-10 md:p-16 rounded-3xl shadow-2xl shadow-gray-900/50">
                            
                            <!-- MAIN HEADER: Joe Greyson Style -->
                            <div class="flex flex-col md:flex-row items-center md:items-start justify-between">
                                
                                <!-- LEFT COLUMN: Intro Text -->
                                <div class="md:w-3/5 text-center md:text-left order-2 md:order-1 pt-8 md:pt-0">
                                    <h4 class="text-xl font-bold text-white">Hi, I'm</h4>
                                    
                                    <h1 class="text-6xl lg:text-8xl font-extrabold pro-text-accent leading-none mb-2">
                                        ${name}
                                    </h1>
                                    
                                    <h2 class="text-4xl font-light text-white mb-6">
                                        ${title}
                                    </h2>
                                    
                                    <p class="text-gray-300 mb-8 max-w-xl mx-auto md:mx-0 whitespace-pre-wrap">${bio}</p>
                                    
                                    <div class="flex justify-center md:justify-start space-x-4 mb-10">
                                        <button class="bg-purple-700 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:bg-purple-800 transition-colors">
                                            Hire Me
                                        </button>
                                        <button class="border border-purple-700 text-white font-semibold py-3 px-8 rounded-lg hover:bg-purple-700 transition-colors">
                                            See Projects
                                        </button>
                                    </div>
                                    
                                    <!-- Social Icons -->
                                    ${socialLinksHTML}
                                </div>
                                
                                <!-- RIGHT COLUMN: Profile Photo -->
                                <div class="md:w-2/5 flex justify-center order-1 md:order-2 mb-8 md:mb-0">
                                    <div class="w-80 h-80 rounded-full overflow-hidden bg-gray-900 border-4 border-purple-700 shadow-2xl">
                                        ${data.profilePhoto ? 
                                            `<img src="${data.profilePhoto}" class="w-full h-full object-cover" alt="User Profile Photo">` 
                                            : 
                                            `<div class="w-full h-full flex items-center justify-center text-8xl text-purple-700">?</div>`
                                        }
                                    </div>
                                </div>
                            </div>
                            
                            <!-- EXTRA LINKS / CERTIFICATES SECTION -->
                            ${(data.extraLinks && data.extraLinks.length > 0) ? `
                                <h3 class="text-3xl font-bold text-white mt-16 mb-6 border-t border-gray-600 pt-8">Certificates & Links</h3>
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                    ${extraLinksList}
                                </div>
                            ` : ''}


                            <!-- SKILLS / PROJECT HIGHLIGHTS SECTION -->
                            ${serviceContent ? `
                                <h3 class="text-3xl font-bold text-white mt-16 mb-6 border-t border-gray-600 pt-8">Key Skills / Focus Areas</h3>
                                <div class="flex flex-wrap gap-3">
                                    ${items.map(skill => `<span class="px-4 py-1.5 bg-purple-700 text-white font-semibold rounded-full text-sm shadow-md">${skill}</span>`).join('')}
                                </div>
                            ` : ''}


                            <!-- KEY DETAILS SECTION (Minimalist) -->
                            ${detailSectionsHTML}


                            <!-- CONFIRMATION BUTTONS -->
                            <div class="flex justify-between items-center pt-10 mt-10 border-t border-gray-600">
                                <button class="bg-gray-600 text-white font-semibold py-2 px-6 rounded-full hover:bg-gray-500 transition-colors" onclick="goBack()">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                                    Make Changes
                                </button>
                                <!-- Updated to call generateMockLink() -->
                                <button id="save-folio-btn" class="bg-purple-700 text-white font-bold py-3 px-8 text-lg rounded-full shadow-xl shadow-purple-900/50 hover:bg-purple-800 transition-transform transform hover:scale-105" onclick="generateMockLink()">
                                    Confirm & Get Shareable Link
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // --- BUSINESS/STUDENT FALLBACK (Using the original asymmetrical style) ---
                
                // Clear previous interval if it exists
                if (imageSliderInterval) {
                    clearInterval(imageSliderInterval);
                }

                // Split content into mock service/project cards (3 columns)
                const serviceItems = serviceContent ? serviceContent.split('\\n').filter(item => item.trim() !== '') : [];

                const serviceCardsHTML = serviceItems.length > 0 ? `
                    <h3 class="text-4xl font-extrabold text-white mt-16 mb-8 border-t border-gray-600 pt-8">My Services / Projects</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${serviceItems.slice(0, 3).map((item, index) => `
                            <div class="bg-gray-900 p-6 rounded-xl border-t-4 border-blue-500 shadow-lg text-center transform hover:scale-[1.02] transition-transform">
                                <div class="mb-4 text-blue-400">
                                    <!-- Mock Icon - Placeholder for a service icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1v-3m-6.5-10l5 5m-5 0l5-5M12 4v16M19 4H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2z" /></svg>
                                </div>
                                <h4 class="text-xl font-bold text-white mb-2">${item.split(':')[0].trim() || 'Service ' + (index + 1)}</h4>
                                <p class="text-gray-400 text-sm">${item.split(':')[1] ? item.split(':')[1].trim() : 'Brief description of the service outcome.'}</p>
                                <button class="mt-4 text-blue-400 text-sm font-semibold hover:underline">Read More</button>
                            </div>
                        `).join('')}
                    </div>
                ` : '';

                // --- IMAGE SLIDER DATA ---
                // Only look for the 3 image links now
                const formImageLinks = [data.imageLink1, data.imageLink2, data.imageLink3].filter(link => link && link.trim() !== '');
                // Use mock images if no links are provided
                const mockImages = formImageLinks.length > 0 ? formImageLinks : [
                    'https://placehold.co/1200x800/2563eb/ffffff?text=Restaurant+Interior+View',
                    'https://placehold.co/1200x800/10b981/ffffff?text=Signature+Dish+Photo',
                    'https://placehold.co/1200x800/f59e0b/ffffff?text=Happy+Customer+Review'
                ];
                
                const imageSliderHTML = (appState.profileType === 'Business Owners') ? `
                    <div class="mt-16 border-t border-gray-600 pt-8">
                        <h3 class="text-4xl font-extrabold text-white mb-8">Our Gallery</h3>
                        <div id="image-slider" class="slider-container max-w-4xl mx-auto">
                            ${mockImages.map((src, index) => 
                                `<img src="${src}" class="slider-image ${index === 0 ? 'active' : ''}" alt="Gallery Image ${index + 1}" onerror="this.src='https://placehold.co/1200x800/6b7280/ffffff?text=Image+Load+Error'">`
                            ).join('')}
                        </div>
                    </div>
                ` : '';

                // --- QUICK TAGS MOCK DATA (Only for non-Business Owners in this flow) ---
                let quickTagsHTML = '';
                if (appState.profileType !== 'Business Owners') {
                    quickTagsHTML = `
                        <div class="flex flex-wrap gap-2 mb-4 justify-center md:justify-start">
                            <span class="px-3 py-1 bg-blue-600 text-white text-sm font-semibold rounded-full shadow-md">
                                üìç ${data.location || 'Your Location'}
                            </span>
                        </div>
                    `;
                }

                return mainContent.innerHTML = `
                    <div class="container mx-auto px-6 main-content">
                        <h2 class="text-4xl font-bold text-white text-center mb-12">
                            3. Final Review & Edit
                        </h2>
                        
                        <div class="max-w-6xl mx-auto bg-gray-700 p-10 rounded-3xl shadow-2xl shadow-gray-900/50 space-y-8">
                            
                            <!-- ASYMMETRICAL HEADER SECTION -->
                            <div class="flex flex-col md:flex-row items-center md:items-start justify-between pb-8 border-b border-gray-600">
                                
                                <!-- LEFT COLUMN: Text Content -->
                                <div class="md:w-3/5 text-center md:text-left order-2 md:order-1">
                                    <h4 class="text-3xl text-blue-400 font-bold mb-1">${name}</h4>
                                    
                                    ${quickTagsHTML}

                                    <h3 class="text-5xl md:text-6xl font-extrabold text-white leading-tight mb-4">
                                        ${title}
                                    </h3>
                                    
                                    <p class="text-gray-300 mt-4 max-w-lg md:max-w-full mx-auto md:mx-0 whitespace-pre-wrap">${bio}</p>
                                    
                                    <div class="mt-8 flex justify-center md:justify-start space-x-4">
                                        <button class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-md hover:bg-blue-700 transition-colors" onclick="openContactModal()">
                                            Contact Now
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- RIGHT COLUMN: Profile Photo (Shifted Inward) -->
                                <div class="md:w-2/5 flex justify-center md:justify-start order-1 md:order-2 mb-8 md:mb-0">
                                    ${data.profilePhoto ? 
                                        `<img src="${data.profilePhoto}" class="w-64 h-64 rounded-full object-cover border-4 border-blue-500 shadow-xl transform translate-x-0 md:-translate-x-1/4">` 
                                        : 
                                        `<div class="w-64 h-64 rounded-full bg-gray-600 flex items-center justify-center text-8xl text-gray-400 border-4 border-blue-500 shadow-xl transform translate-x-0 md:-translate-x-1/4">?</div>`
                                    }
                                </div>
                            </div>
                            
                            <!-- SERVICES / PROJECTS SECTION -->
                            ${serviceCardsHTML}

                            <!-- KEY DETAILS SECTION -->
                            ${detailSectionsHTML}

                            <!-- CONFIRMATION BUTTONS -->
                            <div class="flex justify-between items-center pt-8 border-t border-gray-600">
                                <button class="bg-gray-600 text-white font-semibold py-2 px-6 rounded-full hover:bg-gray-500 transition-colors" onclick="goBack()">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                                    Make Changes
                                </button>
                                <!-- Updated to call generateMockLink() -->
                                <button id="save-folio-btn" class="bg-blue-600 text-white font-bold py-3 px-8 text-lg rounded-full shadow-xl shadow-blue-800/50 hover:bg-blue-700 transition-transform transform hover:scale-105" onclick="generateMockLink()">
                                    Confirm & Get Shareable Link
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                                </button>
                            </div>
                        </div>

                        <!-- DYNAMIC IMAGE SLIDER SECTION (Only for Business Owners) -->
                        ${imageSliderHTML}
                    </div>
                `;
            }

            // Initialization logic for fallback mode (Business Owner slider)
            if (appState.profileType === 'Business Owners') {
                if (imageSliderInterval) {
                    clearInterval(imageSliderInterval);
                }
                // Clear the interval when we leave the preview page
                if (appState.currentPage === 'preview') {
                    const totalImages = mockImages.length;
                    initializeImageSlider('image-slider', totalImages);
                }
            }
        }

        function initializeImageSlider(sliderId, totalImages) {
            let currentImageIndex = 0;
            const sliderElement = document.getElementById(sliderId);
            const images = sliderElement ? sliderElement.querySelectorAll('.slider-image') : [];

            if (images.length === 0) return;

            function showNextImage() {
                // Remove active class from current image
                images[currentImageIndex].classList.remove('active');
                
                // Calculate next index (using modulo to loop back to 0)
                currentImageIndex = (currentImageIndex + 1) % totalImages;
                
                // Add active class to new current image
                images[currentImageIndex].classList.add('active');
            }

            // Ensure the first image is active on load
            images[0].classList.add('active');

            // Set the interval for automatic sliding (1000ms = 1 second)
            imageSliderInterval = setInterval(showNextImage, 1000);
        }


        function renderLinkReadyPage() {
            // Use the actual generated ID for the link
            const actualLink = `https://quickfolio.io/view/${folioId || crypto.randomUUID()}`; 

            mainContent.innerHTML = `
                <div class="container mx-auto px-6 text-center pt-20 pb-16 main-content">
                    <h2 class="text-5xl font-extrabold text-green-400 mb-4">
                        <span class="inline-block animate-bounce mr-2">üéâ</span> Success! Your Quickfolio is Live.
                    </h2>
                    <p class="text-xl text-gray-300 mb-10 max-w-xl mx-auto">
                        Your professional portfolio is now hosted online. Copy this link and share it anywhere!
                    </p>
                    
                    <div class="bg-gray-700 p-6 rounded-2xl shadow-2xl max-w-2xl mx-auto flex flex-col md:flex-row justify-between items-center mb-10 border border-green-600">
                        <input type="text" id="final-link-input" value="${actualLink}" readonly class="w-full bg-transparent border-none outline-none text-blue-400 font-bold text-lg mb-4 md:mb-0 md:mr-4 cursor-pointer text-center md:text-left">
                        <button class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-full hover:bg-blue-700 transition-colors flex-shrink-0" onclick="copyText('final-link-input')">
                            Copy Link
                        </button>
                    </div>

                    <div class="bg-gray-700 p-8 rounded-3xl shadow-xl max-w-3xl mx-auto space-y-4 border-t-4 border-blue-500">
                        <h3 class="text-2xl font-bold text-white flex items-center justify-center">
                            <span class="text-3xl mr-2">üîó</span> Ready to Share
                        </h3>
                        <p class="text-gray-300">You can now share your Quickfolio on all social media platforms, emails, or resumes.</p>
                        <button class="bg-gray-600 text-white font-semibold py-2 px-6 rounded-full hover:bg-gray-500" onclick="alert('In a real application, this would open a share dialog!')">
                            Share on Social Media
                        </button>
                    </div>
                </div>
            `;
            // Clear slider interval when leaving the preview page
            if (imageSliderInterval) {
                clearInterval(imageSliderInterval);
            }
        }

        function renderContactPage() {
             mainContent.innerHTML = `
                 <div class="container mx-auto px-6 text-center pt-20 pb-16 main-content">
                     <h2 class="text-4xl font-bold text-white mb-8">
                         Get in Touch with Quickfolio Support
                     </h2>
                     <div class="max-w-xl mx-auto bg-gray-700 p-10 rounded-3xl shadow-xl border-t-4 border-blue-500">
                         <p class="text-gray-300 mb-6">
                             Have questions, need technical support, or want to suggest a new feature? We'd love to hear from you.
                         </p>
                         <form>
                             <div class="mb-4">
                                 <input type="text" placeholder="Your Full Name" class="w-full px-4 py-3 rounded-xl border-2 border-gray-600 focus:outline-none focus:border-blue-500 transition-colors bg-gray-900 text-white">
                             </div>
                             <div class="mb-4">
                                 <input type="email" placeholder="Your Email Address" class="w-full px-4 py-3 rounded-xl border-2 border-gray-600 focus:outline-none focus:border-blue-500 transition-colors bg-gray-900 text-white">
                             </div>
                             <div class="mb-6">
                                 <textarea placeholder="Your Message/Inquiry" rows="5" class="w-full px-4 py-3 rounded-xl border-2 border-gray-600 focus:outline-none focus:border-blue-500 transition-colors bg-gray-900 text-white"></textarea>
                             </div>
                             <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition-colors">
                                 Send Message
                             </button>
                         </form>
                         
                         <!-- NEW FAKE SOCIAL LINKS SECTION -->
                         <div class="mt-12 pt-8 border-t border-gray-600">
                             <h3 class="text-xl font-bold text-white mb-4">Connect with Us (Mock Links)</h3>
                             <div class="flex justify-center space-x-6">
                                 <!-- Mail Icon -->
                                 <a href="mailto:support@quickfolio.io" target="_blank" class="text-gray-400 hover:text-blue-500 transition-colors">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-17 4v7a2 2 0 002 2h14a2 2 0 002-2v-7" /></svg>
                                 </a>
                                 <!-- Instagram Icon -->
                                 <a href="#" target="_blank" class="text-gray-400 hover:text-pink-500 transition-colors">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M7 2.5a4.5 4.5 0 0 1 9 0V4h3.5a2.5 2.5 0 0 1 2.5 2.5v11A2.5 2.5 0 0 1 19.5 20h-15A2.5 2.5 0 0 1 2 17.5v-11A2.5 2.5 0 0 1 4.5 4H7V2.5ZM12 7.5a4.5 4.5 0 1 0 0 9 4.5 4.5 0 0 0 0-9Zm5.5-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"/></svg>
                                 </a>
                                 <!-- LinkedIn Icon -->
                                 <a href="#" target="_blank" class="text-gray-400 hover:text-blue-700 transition-colors">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor"><path d="M20 0H4C1.791 0 0 1.791 0 4v16c0 2.209 1.791 4 4 4h16c2.209 0 4-1.791 4-4V4c0-2.209-1.791-4-4-4zM8 19H5V8h3v11zM6.5 6.7c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM22 19h-3v-5.604c0-3.368-4-3.565-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                                 </a>
                                 <!-- Optional: Twitter Icon -->
                                 <a href="#" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.794-1.574 2.152-2.716-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.593-1.555-3.15 0-5.696 2.547-5.696 5.696 0 .444.05 1.25.137 1.644-4.743-.238-8.913-2.519-11.721-5.969-.492.846-.777 1.836-.777 2.923 0 1.977 1.05 3.722 2.648 4.733-1.04-.035-2.012-.319-2.858-.79v.064c0 2.74 1.954 5.025 4.552 5.568-.464.125-.954.192-1.46.192-.36 0-.704-.035-1.037-.098 1.44 4.195 5.64 7.234 10.603 7.306-1.933 1.517-4.364 2.428-7.006 2.428-.455 0-.901-.027-1.339-.08 2.494 1.583 5.42 2.508 8.447 2.508 10.134 0 15.63-8.824 15.63-16.486 0-.252-.007-.498-.018-.744.646-.462 1.206-1.042 1.66-1.705z"/></svg>
                                 </a>
                             </div>
                         </div>
                     </div>
                 </div>
             `;
             // Clear slider interval when leaving the preview page
            if (imageSliderInterval) {
                clearInterval(imageSliderInterval);
            }
         }

        // Initial render function called by onAuthStateChanged when Firebase is ready
        window.onload = function() {
            // FIX: Initialize DOM element references here to ensure they exist before updateUI runs
            mainContent = document.getElementById('main-content');
            backButton = document.getElementById('back-button');

            // Since we removed Firebase, we just call updateUI directly
            updateUI(); 
        };
    </script>
</head>
<body class="bg-gray-900 text-white font-['Inter'] antialiased min-h-screen">
    <div id="app-container" class="relative">
        <!-- HEADER / NAVIGATION -->
        <header class="sticky top-0 z-50 bg-gray-900/90 backdrop-blur-sm shadow-xl shadow-gray-900/50">
            <nav class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                <!-- Logo/Title -->
                <div class="flex items-center space-x-2">
                    <!-- NEW HOME ICON (Always visible, always goes to welcome) -->
                    <button class="p-2 rounded-full text-blue-400 hover:bg-gray-700 transition-colors mr-2" onclick="showPage('welcome')">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3m-6 0h.01M6 18h.01M18 18h.01" /></svg>
                    </button>
                    
                    <button id="back-button" class="bg-gray-700 p-2 rounded-full text-white hover:bg-gray-600 transition-colors hidden" onclick="goBack()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                    </button>
                    <h1 class="text-3xl font-extrabold text-white">
                        <span class="text-blue-400">Quickfolio</span>
                    </h1>
                </div>

                <!-- Desktop/Large Screen Links and Icons -->
                <div class="hidden md:flex items-center space-x-6 text-lg font-medium">
                    <!-- Nav links with glowing rectangular frame -->
                    <button class="nav-link-glow text-gray-400 hover:text-white" onclick="showPage('welcome')">Home</button>
                    <button class="nav-link-glow text-gray-400 hover:text-white" onclick="showPage('templates')">Templates</button>
                    <button class="nav-link-glow text-gray-400 hover:text-white" onclick="showPage('contact')">Contact</button>
                    
                    <!-- Small Search Icon -->
                    <button class="text-gray-400 hover:text-white transition-colors ml-4 p-1 rounded-full hover:bg-gray-800" onclick="searchNavClick()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                    
                    <!-- UPDATED: Menu/Hamburger Icon for Desktop (Far Right) -->
                    <button class="text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-gray-800" onclick="toggleMenu()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>

                <!-- Mobile Menu Button (Only visible on small screens) -->
                <button class="md:hidden p-2 rounded-lg text-white bg-gray-800 hover:bg-gray-700 transition-colors" onclick="toggleMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                </button>
            </nav>
        </header>

        <!-- MAIN CONTENT AREA (The target for updateUI) -->
        <main id="main-content" class="min-h-[70vh] py-12"></main>

        <!-- FOOTER -->
        <footer class="text-center py-8 text-gray-400 border-t border-gray-800 mt-12">
            <p>&copy; 2024 Quickfolio. Instant Portfolio Generation.</p>
        </footer>

        <!-- MOBILE MENU OVERLAY -->
        <div id="menu-overlay" class="fixed inset-0 bg-gray-900/95 backdrop-blur-md z-[100] hidden flex-col items-center justify-start pt-20">
            <button class="absolute top-6 right-6 p-3 bg-gray-800 rounded-full text-white hover:bg-gray-700" onclick="toggleMenu()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            
            <nav class="flex flex-col space-y-6 text-2xl font-semibold w-full px-12 text-center">
                <button class="text-white hover:text-blue-400 transition-colors border-b border-gray-800 pb-3" onclick="showPage('welcome')">Home</button>
                <button class="text-white hover:text-blue-400 transition-colors border-b border-gray-800 pb-3" onclick="showPage('templates')">Templates</button>
                <button class="text-white hover:text-blue-400 transition-colors border-b border-gray-800 pb-3" onclick="showPage('contact')">Contact</button>
            
                <!-- Settings/Theme Toggle -->
                <div class="border-b border-gray-800 pb-3">
                    <button class="flex items-center justify-between w-full text-white hover:text-blue-400 transition-colors" onclick="toggleSettingsMenu()">
                        Settings
                        <svg id="settings-arrow" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10l-3.293-3.293a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                    </button>
                    <!-- Nested Menu -->
                    <div id="settings-nested-menu" class="hidden mt-3 bg-gray-800 p-4 rounded-xl text-left space-y-3 shadow-inner">
                        <!-- Theme Toggle -->
                        <div class="flex items-center justify-between border-b border-gray-700 pb-3">
                             <span class="text-lg font-medium text-gray-300" id="theme-text">Dark Mode</span>
                             <button class="p-2 rounded-full bg-gray-700 hover:bg-gray-600 transition-colors text-xl" onclick="toggleTheme()">
                                <span id="theme-icon">üåô</span>
                             </button>
                        </div>
                        
                        <!-- Notification Toggle -->
                        <div class="flex items-center justify-between pt-3">
                            <span class="text-lg font-medium text-gray-300">Notifications</span>
                            <!-- Toggle switch implementation -->
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="bg-blue-600 text-white py-3 px-8 rounded-full hover:bg-blue-700 transition-colors shadow-lg mt-8" onclick="showPage('templates')">
                    Start Building
                </button>
            </nav>
        </div>

        <!-- CONTACT MODAL OVERLAY (Used for Preview Contact Button) -->
        <div id="contact-modal-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-[101] hidden items-center justify-center">
            <div class="bg-gray-900 p-8 rounded-xl max-w-sm w-full shadow-2xl border-t-4 border-blue-500 relative">
                <button class="absolute top-3 right-3 text-gray-400 hover:text-white" onclick="closeContactModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
                <h3 class="text-3xl font-bold text-white mb-4">Contact User</h3>
                <p class="text-gray-300 mb-6">In a real app, this form would send a direct message to the profile owner's email (N/A).</p>
                <form onsubmit="event.preventDefault(); closeContactModal(); alert('Message Sent (Mock)!')">
                    <input type="text" placeholder="Your Name" class="w-full mb-3 px-4 py-3 rounded-xl border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-400">
                    <input type="email" placeholder="Your Email" class="w-full mb-3 px-4 py-3 rounded-xl border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-400">
                    <textarea placeholder="Your Message" rows="4" class="w-full mb-4 px-4 py-3 rounded-xl border-2 border-gray-700 bg-gray-800 text-white placeholder-gray-400"></textarea>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-full hover:bg-blue-700 transition-colors">
                        Send Message
                    </button>
                </form>
            </div>
        </div>

    </div>
</body>
</html>